import React, { useEffect, useRef } from 'react';
import { TouchableOpacity, Animated, StyleSheet, View, Platform } from 'react-native';
import Svg, { Circle, G, Path, Defs, Filter, FeGaussianBlur } from 'react-native-svg';

interface RotatingCatchDetailsBadgeProps {
  onPress: () => void;
  size?: number;
  bottom?: number;
  right?: number;
  left?: number;
  active?: boolean;
}

const RotatingCatchDetailsBadge: React.FC<RotatingCatchDetailsBadgeProps> = ({
  onPress,
  size = 78,
  bottom = 16,
  right = 16,
  left,
  active = true,
}) => {
  const spinValue = useRef(new Animated.Value(0)).current;
  const animationRef = useRef<Animated.CompositeAnimation | null>(null);
  
  const styles = createStyles({ bottom, right, left, size });
  
  useEffect(() => {
    // Her tetiklemede Ã¶nce varsa mevcut loop'u durdur
    animationRef.current?.stop();

    if (!active) return;

    spinValue.setValue(0);
    const animation = Animated.timing(spinValue, {
      toValue: 1,
      duration: 8000,
      useNativeDriver: true,
    });
    const loop = Animated.loop(animation);
    animationRef.current = loop;
    loop.start();

    return () => {
      animationRef.current?.stop();
    };
  }, [active, spinValue]);
  
  const spin = spinValue.interpolate({
    inputRange: [0, 1],
    outputRange: ['0deg', '360deg'],
  });

  const center = size / 2;
  const radius = center - 3;

  return (
    <TouchableOpacity 
      style={styles.badge}
      onPress={onPress}
      activeOpacity={0.8}
    >
      <Animated.View style={[
        styles.rotatingLayer,
        { 
          transform: [{ rotate: spin }],
          borderRadius: size / 2,
        }
      ]}>
        <Svg width={size} height={size} viewBox={`0 0 ${size} ${size}`}>
          <Defs>
            <Filter id="blur">
              <FeGaussianBlur stdDeviation="15" />
            </Filter>
          </Defs>
          
          <Circle
            cx={center}
            cy={center}
            r={radius}
            fill="rgba(0, 0, 0, 0.4)"
            stroke="rgba(255, 255, 255, 0.15)"
            strokeWidth="0.5"
          />
          
          <G transform={`translate(${center}, ${center}) scale(0.120) translate(-410, -410)`}>
              <G>
                <Path d="M308.95,166.07c7.61-3.1,15.45-1.55,20.62,4.53l-7.9,3.22c-2.96-2.63-6.56-3.05-10.24-1.54-5.99,2.44-8.47,8.55-5.63,15.52,2.82,6.92,8.89,9.59,14.88,7.15,3.68-1.5,5.96-4.32,6.22-8.32l7.9-3.22c.58,8.01-3.96,14.55-11.57,17.65-9.86,4.02-20.31-.13-24.5-10.38-4.18-10.26.36-20.58,10.23-24.6Z" fill="#FFFFFF"/>
                <Path d="M373.04,179.48l-14.48,2.75-1.08,7.38-7.66,1.45,6.17-38.88,8.49-1.61,19.98,33.92-7.71,1.46-3.71-6.47ZM361.81,159.82l-2.37,16.2,10.52-2-8.15-14.21Z" fill="#FFFFFF"/>
                <Path d="M394.5,146.84l27.13-.25.06,5.99-9.86.09.29,31-7.42.07-.29-31-9.86.09-.06-5.99Z" fill="#FFFFFF"/>
                <Path d="M457.81,150.37c8.09,1.42,13.91,6.91,15.05,14.8l-8.4-1.48c-1.11-3.8-3.94-6.07-7.86-6.76-6.37-1.12-11.72,2.73-13.03,10.14-1.29,7.36,2.42,12.86,8.79,13.97,3.91.69,7.35-.49,9.7-3.73l8.4,1.48c-3.77,7.09-11.1,10.21-19.19,8.79-10.49-1.84-17.13-10.92-15.22-21.83,1.92-10.91,11.26-17.23,21.75-15.39Z" fill="#FFFFFF"/>
                <Path d="M508.7,187.88l-14.77-5.75-5.71,14.67-6.91-2.69,13.43-34.47,6.91,2.69-5.52,14.17,14.77,5.75,5.52-14.17,6.91,2.69-13.43,34.47-6.91-2.69,5.72-14.67Z" fill="#FFFFFF"/>
                <Path d="M578.08,228.18c-6.84,8.84-17.37,9.88-26.71,2.65l-10.22-7.91,22.64-29.25,10.22,7.91c9.35,7.23,10.95,17.72,4.07,26.6ZM555.02,225.68c6.16,4.77,12.36,3.94,17.07-2.14,4.71-6.08,4.05-12.42-2.11-17.18l-4.15-3.21-14.95,19.32,4.15,3.21Z" fill="#FFFFFF"/>
                <Path d="M613.33,247.05l-9.45-10.39-6.86,6.24,8.38,9.22-4.35,3.96-8.38-9.21-7.25,6.59,9.45,10.39-4.47,4.06-14.44-15.88,27.41-24.92,14.44,15.88-4.47,4.06Z" fill="#FFFFFF"/>
                <Path d="M629.13,257.36l14.89,22.68-5.01,3.29-5.41-8.24-25.91,17.02-4.07-6.2,25.91-17.02-5.41-8.24,5.01-3.29Z" fill="#FFFFFF"/>
                <Path d="M634.65,329.61l-5.77-13.56-7.44.52-3.05-7.17,39.3-2.27,3.38,7.95-28.88,26.75-3.07-7.22,5.53-5ZM651.46,314.45l-16.34,1.14,4.19,9.85,12.14-10.99Z" fill="#FFFFFF"/>
                <Path d="M671.16,345.04l1.87,7.18-35.8,9.31-1.87-7.18,35.8-9.31Z" fill="#FFFFFF"/>
                <Path d="M678.19,379.31l-30.83,4.16,1.63,12.08-5.83.79-2.62-19.43,36.66-4.94.99,7.35Z" fill="#FFFFFF"/>
                <Path d="M643.35,421.55c.16-7.68,4.3-13.54,11.3-13.5l-.16,7.95c-2.97.15-4.97,2.07-5.04,5.52-.07,3.5,1.74,5.6,4.39,5.66,8,.16,3.57-19.01,16.97-18.69,6.68.14,10.6,5.62,10.44,13.25-.15,7.58-4.13,12.69-10.81,13.03l.17-8.16c2.44-.11,4.39-2.03,4.5-5.21.17-2.91-1.22-5.11-4.24-5.18-7.42-.15-3.67,18.9-16.71,18.64-5.83-.12-10.98-4.89-10.81-13.31Z" fill="#FFFFFF"/>
              </G>
              <G>
                <Path d="M207.63,268.06c-3.88-2.64-9.17-1.64-11.81,2.24-2.64,3.88-1.64,9.17,2.24,11.81,3.88,2.64,9.17,1.64,11.81-2.24,2.64-3.88,1.64-9.17-2.24-11.81Z" fill="#FFFFFF"/>
                <Path d="M623.45,551.32c-3.88-2.64-9.17-1.64-11.81,2.24-2.64,3.88-1.64,9.17,2.24,11.81,3.88,2.64,9.17,1.64,11.81-2.24,2.64-3.88,1.64-9.17-2.24-11.81Z" fill="#FFFFFF"/>
                <Path d="M171.75,327.46c-3.26.93-5.15,4.32-4.22,7.58.93,3.26,4.32,5.15,7.58,4.22,3.26-.93,5.15-4.32,4.22-7.58-.93-3.26-4.32-5.15-7.58-4.22Z" fill="#FFFFFF"/>
                <Path d="M573.52,601.15c-3.26.93-5.15,4.32-4.22,7.58s4.32,5.15,7.58,4.22c3.26-.93,5.15-4.32,4.22-7.58s-4.32-5.15-7.58-4.22Z" fill="#FFFFFF"/>
                <Path d="M244.63,220.48c-3.26.93-5.15,4.32-4.22,7.58.93,3.26,4.32,5.15,7.58,4.22,3.26-.93,5.15-4.32,4.22-7.58-.93-3.26-4.32-5.15-7.58-4.22Z" fill="#FFFFFF"/>
                <Path d="M653.98,498.39c-.93-3.26-4.32-5.15-7.58-4.22-3.26.93-5.15,4.32-4.22,7.58.93,3.26,4.32,5.15,7.58,4.22,3.26-.93,5.15-4.32,4.22-7.58Z" fill="#FFFFFF"/>
              </G>
              <G>
                <Path d="M509.83,668.45c-7.64,3.02-15.47,1.38-20.57-4.75l7.94-3.13c2.93,2.66,6.53,3.12,10.23,1.66,6.01-2.38,8.57-8.46,5.8-15.46-2.75-6.95-8.79-9.69-14.8-7.31-3.7,1.46-6.01,4.26-6.31,8.25l-7.93,3.13c-.49-8.01,4.12-14.51,11.76-17.53,9.91-3.92,20.31.35,24.38,10.65s-.59,20.57-10.49,24.49Z" fill="#FFFFFF"/>
                <Path d="M445.89,654.35l14.51-2.59,1.16-7.37,7.67-1.37-6.59,38.81-8.51,1.52-19.61-34.14,7.72-1.38,3.64,6.51ZM456.9,674.13l2.55-16.18-10.54,1.88,7.99,14.29Z" fill="#FFFFFF"/>
                <Path d="M424.08,686.75l-27.14-.04v-5.99s9.87.02,9.87.02l.05-31.01h7.42s-.05,31.02-.05,31.02l9.86.02v5.99Z" fill="#FFFFFF"/>
                <Path d="M360.8,682.53c-8.08-1.51-13.83-7.06-14.89-14.96l8.39,1.57c1.07,3.81,3.87,6.12,7.78,6.84,6.36,1.19,11.76-2.6,13.14-10,1.37-7.35-2.28-12.88-8.64-14.07-3.91-.73-7.36.41-9.74,3.63l-8.39-1.57c3.85-7.05,11.21-10.09,19.29-8.58,10.47,1.96,17.01,11.1,14.98,21.99-2.03,10.89-11.45,17.11-21.92,15.15Z" fill="#FFFFFF"/>
                <Path d="M310.33,644.47l14.7,5.92,5.88-14.6,6.88,2.77-13.81,34.32-6.88-2.77,5.68-14.11-14.7-5.91-5.68,14.11-6.88-2.77,13.81-34.32,6.88,2.77-5.88,14.6Z" fill="#FFFFFF"/>
                <Path d="M241.39,603.42c6.94-8.77,17.47-9.69,26.74-2.36l10.14,8.03-22.96,29-10.14-8.03c-9.27-7.33-10.75-17.84-3.78-26.65ZM264.42,606.17c-6.11-4.83-12.32-4.07-17.09,1.95-4.77,6.03-4.18,12.37,1.93,17.21l4.12,3.26,15.16-19.16-4.11-3.26Z" fill="#FFFFFF"/>
                <Path d="M206.36,584.17l9.33,10.49,6.93-6.16-8.28-9.31,4.4-3.91,8.28,9.3,7.33-6.52-9.33-10.49,4.51-4.02,14.26,16.04-27.68,24.62-14.27-16.04,4.52-4.02Z" fill="#FFFFFF"/>
                <Path d="M190.66,573.68l-14.65-22.84,5.04-3.23,5.32,8.3,26.1-16.73,4,6.24-26.1,16.74,5.32,8.3-5.04,3.23Z" fill="#FFFFFF"/>
                <Path d="M185.94,501.37l5.62,13.62,7.45-.44,2.97,7.2-39.32,1.84-3.3-7.98,29.16-26.43,2.99,7.25-5.58,4.94ZM168.96,516.35l16.35-.96-4.09-9.9-12.26,10.85Z" fill="#FFFFFF"/>
                <Path d="M149.59,485.55l-1.79-7.2,35.9-8.92,1.79,7.2-35.9,8.92Z" fill="#FFFFFF"/>
                <Path d="M142.93,451.21l30.87-3.82-1.5-12.1,5.84-.72,2.41,19.46-36.71,4.54-.91-7.36Z" fill="#FFFFFF"/>
                <Path d="M178.24,409.35c-.24,7.68-4.45,13.49-11.45,13.38l.25-7.95c2.97-.12,4.99-2.02,5.1-5.46.11-3.5-1.68-5.62-4.33-5.7-8-.25-3.77,18.97-17.18,18.5-6.67-.21-10.53-5.74-10.29-13.37.24-7.58,4.26-12.65,10.96-12.92l-.26,8.16c-2.44.08-4.41,1.98-4.56,5.16-.2,2.91,1.17,5.13,4.19,5.22,7.42.23,3.88-18.86,16.91-18.46,5.83.18,10.93,5.01,10.66,13.43Z" fill="#FFFFFF"/>
              </G>
          </G>
        </Svg>
      </Animated.View>
      
      <View
        style={[
          styles.logoLayer,
          {
            width: size,
            height: size,
          }
        ]}
      >
        <Svg width={20} height={20} viewBox="0 0 596.71 606.41">
          <Path 
            fill="#FFFFFF" 
            d="M588.78,235.36c-2.57-3.06-5.25-6.02-7.83-9.07-29.12-34.4-63.3-62.75-102.31-85.26-48.55-28.02-100.6-45.08-156.57-49.93-2.7-.23-5.63-1.98-7.75-3.83-5.65-4.91-10.76-10.45-16.37-15.41-33.16-29.27-70.91-50.22-113.5-62.31-17.17-4.87-34.6-8.34-52.7-9.55.29.8.38,1.29.63,1.69,12.63,19.73,20.72,40.91,22.91,64.51,2.07,22.32-2.21,42.58-15.36,60.84-.57.79-1.03,1.66-2.06,3.32,22.61-10.87,45.47-17.23,68.96-21.73-1.09.91-2.29,1.56-3.56,2.04-11.31,4.27-22.95,7.81-33.89,12.88-51.98,24.06-94.98,59.21-127.88,106.21C16.68,265.22,2.12,304.55.16,348.05c-1.11,24.71,3.65,48.57,12.59,71.57,2.93,7.55,6.61,14.8,9.46,21.1.97-10.43,1.03-21.62,3.18-32.4,9.21-46.13,34.67-82.44,71.22-110.73,29.85-23.11,65.08-33.5,102.26-38.24,25.48-3.25,50.75-3.07,76,1.46,5.19.93,10.28,2.42,15.94,3.78-25.37,25.73-54.98,43.54-85.6,60.94,57.34,11.57,113.56,10.77,170.16-5.57-22.2-24.8-31.61-53.13-27.08-84.91,4.78-33.56,28.64-70.45,46.59-74.02-1.06,1.49-2.67,2.42-4.07,3.6-1.39,1.18-2.72,2.49-3.82,3.94-20.42,27.1-24.98,57.35-16.98,89.7,6.89,27.88,24.19,48.8,46.44,66.02,1.41,1.09,3.72,1.82,5.44,1.58,16.87-2.44,33.98-3.97,50.49-7.97,35.69-8.66,67.56-25.62,96.19-48.54,9.68-7.75,18.79-16.2,28.14-24.31-3.08-3.77-5.47-6.76-7.93-9.68ZM488.67,213.17c-.35,11-10.37,21.56-22.9,20.83-12.31-.01-22.41-10.02-22.65-22.43-.22-11.29,10.41-21.82,22.12-21.91,12.69-.1,23.83,10.82,23.43,23.51Z"
          />
          <Path 
            fill="#FFFFFF" 
            d="M174.51,432.56c-16.5-3.46-33.12-6.58-49.36-11.05-17.9-4.92-33.25-14.32-43.67-30.36-7.63-11.76-10.83-24.84-11.35-38.69-.11-2.97-.02-5.94-.02-8.91-15.05,20.89-23.82,43.81-27.53,68.58-3.34,22.31-1.2,44.53,3.64,66.35,9.67,43.55,30.39,81.3,61.69,113.13,4.94,5.02,10.41,9.51,16.26,14.81,14.52-37.43,17.27-74.74,9.62-113.15,23.88,3.95,46.89,2.9,69.76-2.47,20.41-4.79,40.96-8.46,62.07-7.49.61.03,1.24-.2,3.03-.51-5.87-4.97-10.84-9.38-16.02-13.53-23.08-18.51-49.16-30.63-78.12-36.71Z"
          />
        </Svg>
      </View>
    </TouchableOpacity>
  );
};

const createStyles = ({ bottom, right, left, size }: { bottom: number; right?: number; left?: number; size: number }) =>
  StyleSheet.create({
    badge: {
      position: 'absolute',
      bottom: bottom,
      ...(right !== undefined && { right: right }),
      ...(left !== undefined && { left: left }),
      width: size,
      height: size,
      alignItems: 'center',
      justifyContent: 'center',
    },
    rotatingLayer: {
      backgroundColor: 'rgba(0, 0, 0, 0.3)',
      ...(Platform.OS === 'ios' && {
        shadowColor: '#000',
        shadowOffset: { width: 0, height: 2 },
        shadowOpacity: 0.25,
        shadowRadius: 10
      })
    },
    logoLayer: {
      position: 'absolute',
      top: 0,
      left: 0,
      alignItems: 'center',
      justifyContent: 'center',
    }
  });

export default RotatingCatchDetailsBadge;